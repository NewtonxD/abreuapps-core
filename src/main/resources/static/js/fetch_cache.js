L.TileLayer.Fetch=L.TileLayer.extend({_objectUrlCache:{},createTile:function(e,t){let r=document.createElement("img");L.DomEvent.on(r,"load",L.Util.bind(this._tileOnLoad,this,t,r)),L.DomEvent.on(r,"error",L.Util.bind(this._tileOnError,this,t,r));let n=this.getTileUrl(e),c=()=>{fetch(n).then(e=>{if(!e.ok)throw Error("Network response was not ok");isCacheEnabled&&caches.open(TILE_CACHE_NAME).then(t=>{t.put(n,e.clone())}),r.src=n}).catch(e=>{console.error("Fetch error:",e),t(e,null)})},i=(e,t)=>{let n=URL.createObjectURL(e);this._objectUrlCache[t]=n,r.src=n};return isCacheEnabled?caches.open(TILE_CACHE_NAME).then(e=>{e.match(n).then(e=>{e?this._objectUrlCache[n]?r.src=this._objectUrlCache[n]:e.arrayBuffer().then(e=>{let t=new Blob([e],{type:"image/webp"});i(t,n)}):c()})}):c(),r}}),L.tileLayer.fetch=function(e){return new L.TileLayer.Fetch(e)};