L.TileLayer.Fetch=L.TileLayer.extend({_oUC:{},createTile:function(e,t){let r=document.createElement("img");L.DomEvent.on(r,"load",L.Util.bind(this._tileOnLoad,this,t,r)),L.DomEvent.on(r,"error",L.Util.bind(this._tileOnError,this,t,r));let n=this.getTileUrl(e),o=()=>{fetch(n).then(e=>{if(!e.ok)throw Error("Network response was not ok");return e.blob()}).then(e=>{let t=URL.createObjectURL(e);this._oUC[n]=t,r.src=t,isCacheEnabled&&caches.open(TILE_CACHE_NAME).then(t=>{t.put(n,new Response(e))})}).catch(e=>{console.error("Fetch error:",e),t(e,null)})};return isCacheEnabled?caches.open(TILE_CACHE_NAME).then(e=>{e.match(n).then(e=>{e?this._oUC[n]?r.src=this._oUC[n]:e.blob().then(e=>{let t=URL.createObjectURL(e);this._oUC[n]=t,r.src=t}):o()})}):o(),r}}),L.tileLayer.fetch=function(e){return new L.TileLayer.Fetch(e)};